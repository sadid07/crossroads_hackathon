{"ast":null,"code":"import _defineProperty from\"/home/kawsar/teast/incomeexpensesapi-master (copy)/BorbitplugBackEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/kawsar/teast/incomeexpensesapi-master (copy)/BorbitplugBackEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/kawsar/teast/incomeexpensesapi-master (copy)/BorbitplugBackEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/kawsar/teast/incomeexpensesapi-master (copy)/BorbitplugBackEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/kawsar/teast/incomeexpensesapi-master (copy)/BorbitplugBackEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{CardElement,injectStripe,Elements,StripeProvider}from\"react-stripe-elements\";import{Button,Container,Dimmer,Divider,Form,Header,Image,Item,Label,Loader,Message,Segment,Select}from\"semantic-ui-react\";import{Link,withRouter,NavLink}from\"react-router-dom\";import{authAxios}from\"../utils\";import{checkoutURL,orderSummaryURL,addCouponURL,addressListURL}from\"../constants\";var OrderPreview=function OrderPreview(props){var data=props.data;console.log(data);return/*#__PURE__*/React.createElement(React.Fragment,null,data&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Item.Group,{relaxed:true},data.order_items.map(function(orderItem,i){return/*#__PURE__*/React.createElement(Item,{key:i},/*#__PURE__*/React.createElement(Item.Image,{size:\"tiny\",src:\"http://127.0.0.1:8000\".concat(orderItem.item.image)}),/*#__PURE__*/React.createElement(Item.Content,{verticalAlign:\"middle\"},/*#__PURE__*/React.createElement(Item.Header,{as:\"a\"},orderItem.quantity,\" x \",orderItem.item.title),/*#__PURE__*/React.createElement(Item.Extra,null,/*#__PURE__*/React.createElement(Label,null,\"$\",orderItem.final_price))));})),/*#__PURE__*/React.createElement(Item.Group,null,/*#__PURE__*/React.createElement(Item,null,/*#__PURE__*/React.createElement(Item.Content,null,/*#__PURE__*/React.createElement(Item.Header,null,\"Order Total: $\",data.total,data.coupon&&/*#__PURE__*/React.createElement(Label,{color:\"green\",style:{marginLeft:\"10px\"}},\"Current coupon: \",data.coupon.code,\" for $\",data.coupon.amount)))))));};var CouponForm=/*#__PURE__*/function(_Component){_inherits(CouponForm,_Component);var _super=_createSuper(CouponForm);function CouponForm(){var _this;_classCallCheck(this,CouponForm);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={code:\"\"};_this.handleChange=function(e){_this.setState({code:e.target.value});};_this.handleSubmit=function(e){var code=_this.state.code;_this.props.handleAddCoupon(e,code);_this.setState({code:\"\"});};return _this;}_createClass(CouponForm,[{key:\"render\",value:function render(){var code=this.state.code;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Form,{onSubmit:this.handleSubmit},/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Coupon code\"),/*#__PURE__*/React.createElement(\"input\",{placeholder:\"Enter a coupon..\",value:code,onChange:this.handleChange})),/*#__PURE__*/React.createElement(Button,{type:\"submit\"},\"Submit\")));}}]);return CouponForm;}(Component);var CheckoutForm=/*#__PURE__*/function(_Component2){_inherits(CheckoutForm,_Component2);var _super2=_createSuper(CheckoutForm);function CheckoutForm(){var _this2;_classCallCheck(this,CheckoutForm);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this2=_super2.call.apply(_super2,[this].concat(args));_this2.state={data:null,loading:false,error:null,success:false,shippingAddresses:[],billingAddresses:[],selectedBillingAddress:\"\",selectedShippingAddress:\"\"};_this2.handleGetDefaultAddress=function(addresses){var filteredAddresses=addresses.filter(function(el){return el.default===true;});if(filteredAddresses.length>0){return filteredAddresses[0].id;}return\"\";};_this2.handleFetchBillingAddresses=function(){_this2.setState({loading:true});authAxios.get(addressListURL(\"B\")).then(function(res){_this2.setState({billingAddresses:res.data.results.map(function(a){return{key:a.id,text:\"\".concat(a.street_address,\", \").concat(a.apartment_address,\", \").concat(a.country),value:a.id};}),selectedBillingAddress:_this2.handleGetDefaultAddress(res.data.results),loading:false});}).catch(function(err){_this2.setState({error:err,loading:false});});};_this2.handleFetchShippingAddresses=function(){_this2.setState({loading:true});authAxios.get(addressListURL(\"S\")).then(function(res){console.log(res.data.result);_this2.setState({shippingAddresses:res.data.results.map(function(a){console.log(a.id);return{key:a.id,text:\"\".concat(a.street_address,\", \").concat(a.apartment_address,\", \").concat(a.country),value:a.id};}),selectedShippingAddress:_this2.handleGetDefaultAddress(res.data.results),loading:false});}).catch(function(err){_this2.setState({error:err,loading:false});});};_this2.handleFetchOrder=function(){_this2.setState({loading:true});authAxios.get(orderSummaryURL).then(function(res){_this2.setState({data:res.data,loading:false});}).catch(function(err){if(err.response.status===404){_this2.props.history.push(\"/products\");}else{_this2.setState({error:err,loading:false});}});};_this2.handleAddCoupon=function(e,code){e.preventDefault();_this2.setState({loading:true});authAxios.post(addCouponURL,{code:code}).then(function(res){_this2.setState({loading:false});_this2.handleFetchOrder();}).catch(function(err){_this2.setState({error:err,loading:false});});};_this2.handleSelectChange=function(e,_ref){var name=_ref.name,value=_ref.value;_this2.setState(_defineProperty({},name,value));};_this2.submit=function(ev){ev.preventDefault();_this2.setState({loading:true});// this.props.stripe.createToken().then(result => {\n//   console.log('result', result)\n//     this.setState({ error: null });\n//     const {\n//       selectedBillingAddress,\n//       selectedShippingAddress\n//     } = this.state;\nvar _this2$state=_this2.state,selectedBillingAddress=_this2$state.selectedBillingAddress,selectedShippingAddress=_this2$state.selectedShippingAddress;// console.log('result.token.id', result.token.id)\nauthAxios.post(checkoutURL,{// stripeToken: result.token.id,\nselectedBillingAddress:selectedBillingAddress,selectedShippingAddress:selectedShippingAddress}).then(function(res){_this2.setState({loading:false,success:true});_this2.props.history.push('/');}).catch(function(err){_this2.setState({loading:false,error:err});console.log(err.response.data);});// });\n};return _this2;}_createClass(CheckoutForm,[{key:\"componentDidMount\",value:function componentDidMount(){this.handleFetchOrder();this.handleFetchBillingAddresses();this.handleFetchShippingAddresses();}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,data=_this$state.data,error=_this$state.error,loading=_this$state.loading,success=_this$state.success,billingAddresses=_this$state.billingAddresses,shippingAddresses=_this$state.shippingAddresses,selectedBillingAddress=_this$state.selectedBillingAddress,selectedShippingAddress=_this$state.selectedShippingAddress;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(OrderPreview,{data:data}),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(CouponForm,{handleAddCoupon:function handleAddCoupon(e,code){return _this3.handleAddCoupon(e,code);}}),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(Header,null,\"Select a billing address\"),billingAddresses.length>0?/*#__PURE__*/React.createElement(Select,{name:\"selectedBillingAddress\",value:selectedBillingAddress,clearable:true,options:billingAddresses,selection:true,onChange:this.handleSelectChange}):/*#__PURE__*/React.createElement(\"p\",null,\"You need to \",/*#__PURE__*/React.createElement(Link,{to:\"/profile\"},\"add a billing address\")),/*#__PURE__*/React.createElement(Header,null,\"Select a shipping address\"),shippingAddresses.length>0?/*#__PURE__*/React.createElement(Select,{name:\"selectedShippingAddress\",value:selectedShippingAddress,clearable:true,options:shippingAddresses,selection:true,onChange:this.handleSelectChange}):/*#__PURE__*/React.createElement(\"p\",null,\"You need to \",/*#__PURE__*/React.createElement(Link,{to:\"/profile\"},\"add a shipping address\")),/*#__PURE__*/React.createElement(Divider,null),billingAddresses.length<1||shippingAddresses.length<1?/*#__PURE__*/React.createElement(\"p\",null,\"You need to add addresses before you can complete your purchase\"):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Header,null,\"Would you like to complete the purchase?\"),/*#__PURE__*/React.createElement(CardElement,null),success&&/*#__PURE__*/React.createElement(Message,{positive:true},/*#__PURE__*/React.createElement(Message.Header,null,\"Your payment was successful\"),/*#__PURE__*/React.createElement(\"p\",null,\"Go to your \",/*#__PURE__*/React.createElement(\"b\",null,\"profile\"),\" to see the order delivery status.\")),/*#__PURE__*/React.createElement(Button,{loading:loading,disabled:loading,primary:true,onClick:this.submit,style:{marginTop:\"10px\"}},\"Submits\")));}}]);return CheckoutForm;}(Component);var InjectedForm=withRouter(injectStripe(CheckoutForm));var WrappedForm=function WrappedForm(){return/*#__PURE__*/React.createElement(Container,{text:true},/*#__PURE__*/React.createElement(StripeProvider,{apiKey:\"null\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"Complete your order\"),/*#__PURE__*/React.createElement(Elements,null,/*#__PURE__*/React.createElement(InjectedForm,null)))));};export default WrappedForm;","map":{"version":3,"sources":["/home/kawsar/teast/incomeexpensesapi-master (copy)/BorbitplugBackEnd/src/containers/Checkout.js"],"names":["React","Component","CardElement","injectStripe","Elements","StripeProvider","Button","Container","Dimmer","Divider","Form","Header","Image","Item","Label","Loader","Message","Segment","Select","Link","withRouter","NavLink","authAxios","checkoutURL","orderSummaryURL","addCouponURL","addressListURL","OrderPreview","props","data","console","log","order_items","map","orderItem","i","item","image","quantity","title","final_price","total","coupon","marginLeft","code","amount","CouponForm","state","handleChange","e","setState","target","value","handleSubmit","handleAddCoupon","CheckoutForm","loading","error","success","shippingAddresses","billingAddresses","selectedBillingAddress","selectedShippingAddress","handleGetDefaultAddress","addresses","filteredAddresses","filter","el","default","length","id","handleFetchBillingAddresses","get","then","res","results","a","key","text","street_address","apartment_address","country","catch","err","handleFetchShippingAddresses","result","handleFetchOrder","response","status","history","push","preventDefault","post","handleSelectChange","name","submit","ev","marginTop","InjectedForm","WrappedForm"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport {\n  CardElement,\n  injectStripe,\n  Elements,\n  StripeProvider\n} from \"react-stripe-elements\";\nimport {\n  Button,\n  Container,\n  Dimmer,\n  Divider,\n  Form,\n  Header,\n  Image,\n  Item,\n  Label,\n  Loader,\n  Message,\n  Segment,\n  Select\n} from \"semantic-ui-react\";\nimport { Link, withRouter,NavLink } from \"react-router-dom\";\nimport { authAxios } from \"../utils\";\nimport {\n  checkoutURL,\n  orderSummaryURL,\n  addCouponURL,\n  addressListURL\n} from \"../constants\";\n\nconst OrderPreview = props => {\n  const { data } = props;\n  console.log(data)\n  return (\n    <React.Fragment>\n      {data && (\n        <React.Fragment>\n          <Item.Group relaxed>\n            {data.order_items.map((orderItem, i) => {\n              return (\n                <Item key={i}>\n                  <Item.Image\n                    size=\"tiny\"\n                    src={`http://127.0.0.1:8000${orderItem.item.image}`}\n                  />\n                  <Item.Content verticalAlign=\"middle\">\n                    <Item.Header as=\"a\">\n                      {orderItem.quantity} x {orderItem.item.title}\n                    </Item.Header>\n                    <Item.Extra>\n                      <Label>${orderItem.final_price}</Label>\n                    </Item.Extra>\n                  </Item.Content>\n                </Item>\n              );\n            })}\n          </Item.Group>\n          <Item.Group>\n            <Item>\n              <Item.Content>\n                <Item.Header>\n                  Order Total: ${data.total}\n                  {data.coupon && (\n                    <Label color=\"green\" style={{ marginLeft: \"10px\" }}>\n                      Current coupon: {data.coupon.code} for $\n                      {data.coupon.amount}\n                    </Label>\n                  )}\n                </Item.Header>\n              </Item.Content>\n            </Item>\n          </Item.Group>\n        </React.Fragment>\n      )}\n    </React.Fragment>\n  );\n};\n\nclass CouponForm extends Component {\n  state = {\n    code: \"\"\n  };\n\n  handleChange = e => {\n    this.setState({\n      code: e.target.value\n    });\n  };\n\n  handleSubmit = e => {\n    const { code } = this.state;\n    this.props.handleAddCoupon(e, code);\n    this.setState({ code: \"\" });\n  };\n\n  render() {\n    const { code } = this.state;\n    return (\n      <React.Fragment>\n        <Form onSubmit={this.handleSubmit}>\n          <Form.Field>\n            <label>Coupon code</label>\n            <input\n              placeholder=\"Enter a coupon..\"\n              value={code}\n              onChange={this.handleChange}\n            />\n          </Form.Field>\n          <Button type=\"submit\">Submit</Button>\n        </Form>\n      </React.Fragment>\n    );\n  }\n}\n\nclass CheckoutForm extends Component {\n  state = {\n    data: null,\n    loading: false,\n    error: null,\n    success: false,\n    shippingAddresses: [],\n    billingAddresses: [],\n    selectedBillingAddress: \"\",\n    selectedShippingAddress: \"\"\n  };\n\n  componentDidMount() {\n    this.handleFetchOrder();\n    this.handleFetchBillingAddresses();\n    this.handleFetchShippingAddresses();\n  }\n\n  handleGetDefaultAddress = addresses => {\n    const filteredAddresses = addresses.filter(el => el.default === true);\n    if (filteredAddresses.length > 0) {\n      return filteredAddresses[0].id;\n    }\n    return \"\";\n  };\n\n  handleFetchBillingAddresses = () => {\n    this.setState({ loading: true });\n    authAxios\n      .get(addressListURL(\"B\"))\n      .then(res => {\n        this.setState({\n          billingAddresses: res.data.results.map(a => {\n            \n            return {\n              key: a.id,\n              text: `${a.street_address}, ${a.apartment_address}, ${a.country}`,\n              value: a.id\n            };\n          }),\n          \n          selectedBillingAddress: this.handleGetDefaultAddress(res.data.results),\n          loading: false\n        });\n      })\n      .catch(err => {\n        this.setState({ error: err, loading: false });\n      });\n  };\n\n  handleFetchShippingAddresses = () => {\n    this.setState({ loading: true });\n    authAxios\n      .get(addressListURL(\"S\"))\n      .then(res => {\n        console.log(res.data.result)\n        \n        this.setState({\n          shippingAddresses: res.data.results.map(a => {\n            console.log(a.id)\n            return {\n              key: a.id,\n              text: `${a.street_address}, ${a.apartment_address}, ${a.country}`,\n              value: a.id\n            };\n          }),\n          selectedShippingAddress: this.handleGetDefaultAddress(res.data.results),\n          loading: false\n        });\n      })\n      .catch(err => {\n        this.setState({ error: err, loading: false });\n      });\n  };\n\n  handleFetchOrder = () => {\n    this.setState({ loading: true });\n    authAxios\n      .get(orderSummaryURL)\n      .then(res => {\n        this.setState({ data: res.data, loading: false });\n      })\n      .catch(err => {\n        if (err.response.status === 404) {\n          this.props.history.push(\"/products\");\n        } else {\n          this.setState({ error: err, loading: false });\n        }\n      });\n  };\n\n  handleAddCoupon = (e, code) => {\n    e.preventDefault();\n    this.setState({ loading: true });\n    authAxios\n      .post(addCouponURL, { code })\n      .then(res => {\n        this.setState({ loading: false });\n        this.handleFetchOrder();\n      })\n      .catch(err => {\n        this.setState({ error: err, loading: false });\n      });\n  };\n\n  handleSelectChange = (e, { name, value }) => {\n    this.setState({ [name]: value });\n  };\n\n  submit = ev => {\n    ev.preventDefault();\n\n    this.setState({ loading: true });\n  \n      // this.props.stripe.createToken().then(result => {\n      //   console.log('result', result)\n      //     this.setState({ error: null });\n      //     const {\n      //       selectedBillingAddress,\n      //       selectedShippingAddress\n      //     } = this.state;\n        const {\n          selectedBillingAddress,\n          selectedShippingAddress\n        } = this.state;\n\n          // console.log('result.token.id', result.token.id)\n          authAxios\n        \n            .post(checkoutURL, {\n              // stripeToken: result.token.id,\n              selectedBillingAddress,\n              selectedShippingAddress\n            })\n            .then(res => {\n              this.setState({ loading: false, success: true });\n              this.props.history.push('/');\n            })\n            .catch(err => {\n              this.setState({ loading: false, error: err });\n              console.log (err.response.data)\n            });\n      \n      // });\n \n  };\n\n  render() {\n    const {\n      data,\n      error,\n      loading,\n      success,\n      billingAddresses,\n      shippingAddresses,\n      selectedBillingAddress,\n      selectedShippingAddress\n    } = this.state;\n   \n    return (\n      <div>\n   \n\n        <OrderPreview data={data} />\n        <Divider />\n        <CouponForm\n          handleAddCoupon={(e, code) => this.handleAddCoupon(e, code)}\n        />\n        <Divider />\n        <Header>Select a billing address</Header>\n       \n        {billingAddresses.length > 0 ? (\n          <Select\n            name=\"selectedBillingAddress\"\n            value={selectedBillingAddress}\n            clearable\n            options={billingAddresses}\n            selection\n            onChange={this.handleSelectChange}\n          />\n        ) : (\n            <p>\n              You need to <Link to=\"/profile\">add a billing address</Link>\n            </p>\n          )}\n        <Header>Select a shipping address</Header>\n        {shippingAddresses.length > 0 ? (\n          <Select\n            name=\"selectedShippingAddress\"\n            value={selectedShippingAddress}\n            clearable\n            options={shippingAddresses}\n            selection\n            onChange={this.handleSelectChange}\n          />\n        ) : (\n            <p>\n              You need to <Link to=\"/profile\">add a shipping address</Link>\n            </p>\n          )}\n        <Divider />\n\n        {billingAddresses.length < 1 || shippingAddresses.length < 1 ? (\n          <p>You need to add addresses before you can complete your purchase</p>\n        ) : (\n            <React.Fragment>\n              <Header>Would you like to complete the purchase?</Header>\n              <CardElement />\n              {success && (\n                <Message positive>\n                  <Message.Header>Your payment was successful</Message.Header>\n                  <p>\n                    Go to your <b>profile</b> to see the order delivery status.\n                </p>\n                </Message>\n              )}\n              <Button\n                loading={loading}\n                disabled={loading}\n                primary\n                onClick={this.submit}\n                style={{ marginTop: \"10px\" }}\n              >\n                Submits\n            </Button>\n            </React.Fragment>\n          )}\n    \n      </div>\n    );\n  }\n}\n\nconst InjectedForm = withRouter(injectStripe(CheckoutForm));\n\nconst WrappedForm = () => (\n  <Container text>\n    <StripeProvider apiKey='null'>\n      <div>\n        <h1>Complete your order</h1>\n        <Elements>\n          <InjectedForm />\n        </Elements>\n      </div>\n    </StripeProvider>\n  </Container>\n);\n\nexport default WrappedForm;\n"]},"metadata":{},"sourceType":"module"}